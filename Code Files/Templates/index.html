<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Customer Segmentation</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <style>
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: #1c1c1c;
      color: #f5f5f5;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    header {
      padding: 30px;
      font-size: 2.5rem;
      font-weight: bold;
      color: #fff;
      text-align: center;
      letter-spacing: 2px;
      text-shadow: 0px 0px 12px rgba(0, 191, 255, 0.7);
    }

    .card {
      background: #2b2b2b;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.6);
      padding: 30px;
      width: 85%;
      max-width: 900px;
      margin: 20px auto;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 35px rgba(0, 191, 255, 0.4);
    }

    form {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    label {
      font-size: 0.9rem;
      color: #bbb;
    }

    input {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 8px;
      outline: none;
      background: #3a3a3a;
      color: #fff;
      font-weight: bold;
    }

    input:focus {
      box-shadow: 0 0 8px #00bfff;
    }

    button {
      grid-column: span 2;
      background: #00bfff;
      color: #fff;
      padding: 12px;
      font-size: 1.1rem;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    button:hover {
      background: #009acd;
      transform: scale(1.05);
    }

    #result {
      margin-top: 30px;
      width: 85%;
      max-width: 900px;
    }

    .result-card {
      background: #2f2f2f;
      border-radius: 16px;
      padding: 25px;
      box-shadow: 0 8px 25px rgba(0, 191, 255, 0.3);
      animation: fadeIn 0.8s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .customer-type {
      font-size: 1.5rem;
      font-weight: bold;
      margin-top: 10px;
      color: #00bfff;
    }

    .probabilities {
      margin-top: 20px;
      font-size: 1rem;
      color: #ddd;
    }

    .progress-bar {
      background: #444;
      border-radius: 10px;
      overflow: hidden;
      margin: 6px 0;
      height: 20px;
    }

    .progress-fill {
      height: 100%;
      width: 0;
      transition: width 1s ease-in-out;
    }
  </style>
</head>
<body>

  <header>üõçÔ∏è Customer Archetype Detector</header>

  <div class="card">
    <form id="predictionForm">
      <label>InvoiceNo:</label>
      <input type="text" name="InvoiceNo" required>

      <label>StockCode:</label>
      <input type="text" name="StockCode" required>

      <label>Description:</label>
      <input type="text" name="Description" required>

      <label>Quantity:</label>
      <input type="number" name="Quantity" required>

      <label>UnitPrice:</label>
      <input type="number" step="0.01" name="UnitPrice" required>

      <label>CustomerID:</label>
      <input type="number" name="CustomerID" required>

      <label>Country:</label>
      <input type="text" name="Country" required>

      <label>InvoiceYear:</label>
      <input type="number" name="InvoiceYear" required>

      <label>InvoiceMonth:</label>
      <input type="number" name="InvoiceMonth" required>

      <label>InvoiceDay:</label>
      <input type="number" name="InvoiceDay" required>

      <label>InvoiceHour:</label>
      <input type="number" name="InvoiceHour" required>

      <label>InvoiceWeekday:</label>
      <input type="number" name="InvoiceWeekday" required>

      <label>TransactionType:</label>
      <input type="text" name="TransactionType" required>

      <button type="button" id="predictBtn">üöÄ Predict</button>
    </form>
  </div>

  <div id="result"></div>

<script>
  document.getElementById("predictBtn").addEventListener("click", async function(e) {
    e.preventDefault();

    let form = document.getElementById("predictionForm");
    let formData = {};
    new FormData(form).forEach((value, key) => formData[key] = value);

    try {
      const response = await fetch("/predict", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData)
      });

      const result = await response.json();
      console.log("Backend response:", result);

      if (result.error) {
        document.getElementById("result").innerHTML =
          `<p style="color:red;">Error: ${result.error}</p>`;
      } else {
        let probsHtml = "<div class='probabilities'><h3>üìä Probabilities</h3>";
        for (let [type, prob] of Object.entries(result.Probabilities)) {
          const percent = (prob * 100).toFixed(2);
          const color = type === "Premium" ? "#00bfff" :
                        type === "Occasional" ? "#ffb347" : "#32cd32";
          probsHtml += `
            <p><b>${type}:</b> ${percent}%</p>
            <div class="progress-bar">
              <div class="progress-fill" style="background:${color}; width:0%;" data-width="${percent}%"></div>
            </div>
          `;
        }
        probsHtml += "</div>";

        document.getElementById("result").innerHTML = `
          <div class="result-card">
            <h2>‚ú® Prediction Result</h2>
            <p><b>Cluster:</b> ${result.Cluster}</p>
            <p class="customer-type">${result.CustomerType}</p>
            ${probsHtml}
          </div>
        `;

        // Animate bars
        document.querySelectorAll(".progress-fill").forEach(bar => {
          const width = bar.getAttribute("data-width");
          setTimeout(() => {
            bar.style.width = width;
          }, 200);
        });
      }
    } catch (err) {
      document.getElementById("result").innerHTML =
        `<p style="color:red;">Request failed: ${err}</p>`;
    }
  });
</script>

</body>
</html>
